## 使用介绍

### 一、服务端(Raft节点)

#### 1. 主程序

`Raft`节点的主程序是`raft.go`源文件中的`main`函数，编译后可以得到`Raft`节点的服务端程序`raft.exe`。

启动一个`raft`节点的服务端程序需要以下五种命令行参数：

- `http_addr`：`raft`节点与客户端程序进行通信的`http`接口地址
- `raft_addr`：`raft`节点用来与其他`raft`节点进行共识通信时使用的接口地址
- `raft_id`：`raft`节点的`id`身份标识符
- `raft_cluster`：需要为当前`raft`节点指明`raft`集群中其他节点的`raft_id`和`raft_addr`，当前`raft`节点基于此与其他节点完成连接。
- `http_raft_addr_map`：需要为当前`raft`节点指明`raft`集群中其他节点的`http_addr`。由于`raft`协议中只有`term`中的主节点`master`才能进行写操作，因此当前节点收到来自客户端的写操作请求时，需要将其转发给`master`。

假设现在我们初始化有三个`raft`节点，三个节点分别成为`node1`,`node2`,`node3`, `bat`启动脚本如下：

```bash
@echo off
start  "node1"  .\raft --http_addr=127.0.0.1:7001 --raft_addr=127.0.0.1:7000 --raft_id=1 --raft_cluster=1/127.0.0.1:7000,2/127.0.0.1:8000,3/127.0.0.1:9000 --http_raft_addr_map=127.0.0.1:7001/127.0.0.1:7000,127.0.0.1:8001/127.0.0.1:8000,127.0.0.1:9001/127.0.0.1:9000

start  "node2"  .\raft --http_addr=127.0.0.1:8001 --raft_addr=127.0.0.1:8000 --raft_id=2 --raft_cluster=1/127.0.0.1:7000,2/127.0.0.1:8000,3/127.0.0.1:9000 --http_raft_addr_map=127.0.0.1:7001/127.0.0.1:7000,127.0.0.1:8001/127.0.0.1:8000,127.0.0.1:9001/127.0.0.1:9000

start  "node3"  .\raft --http_addr=127.0.0.1:9001 --raft_addr=127.0.0.1:9000 --raft_id=3 --raft_cluster=1/127.0.0.1:7000,2/127.0.0.1:8000,3/127.0.0.1:9000 --http_raft_addr_map=127.0.0.1:7001/127.0.0.1:7000,127.0.0.1:8001/127.0.0.1:8000,127.0.0.1:9001/127.0.0.1:9000

```

#### 2. 合约模块

合约模块需要用户自定义设计，`raft`节点在收到来自客户端的请求后，将其包装为交易提交给合约模块。合约模块将完成对交易的执行。

合约模块代码位于`/contract`目录下，当前仅提供了能够实现简单读写操作的`Common`合约，包括`Common:Write`和`Common:Read`两种合约函数。

用户需要在`/contract/contract.go`中添加自定义的合约类，然后再为该合约类创建属于自己的处理函数和源文件。

#### 3. `Web`接口模块

每一个`raft`节点都有`Web`后端模块，用来接收客户端的`http`请求，并在处理之后进行共识。

`Web`接口模块代码位于`/api/httpApi.go`文件中。如果要绑定新的`Web`接口，请自行设计。

> 需要注意：
>
> 为了提高读交易的处理速率，可以选择在节点本地执行读取操作(而非交给master节点处理)。
>
> 因此对于设计读操作的交易，请在接口函数`CreateNewTransaction`中额外添加处理逻辑，直接从本地读取结果并返回给客户端即可

### 二、测试客户端

客户端主要用于测试`raft`节点的合约功能是否完善，以及最大`TPS`。

客户端测试程序位于`/client/client_test.go`中。用户可以根据自己的需要，设计相关的验证函数去验证自定义合约的功能以及`TPS`。